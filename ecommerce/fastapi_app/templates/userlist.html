{% extends 'base.html' %}

{% block title %}User Management{% endblock %}

{% block content %}
<div class="card-glass p-6 rounded-xl overflow-x-auto">
    <div class="flex justify-between items-center mb-6">
        <h4 class="text-xl font-semibold text-text-primary">User Accounts</h4>
        <a href="{{ url_for('add_user_get') }}" class="bg-accent-indigo text-white px-4 py-2 rounded-lg hover:bg-accent-indigo/80 transition-colors">
            Add New User
        </a>
    </div>
    
    <table id="usersTable" class="min-w-full data-table rounded-lg overflow-hidden">
        <thead>
            <tr>
                <th>User ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Joined</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %} {# Changed from userlist to users based on app.py context #}
            <tr>
                <td>{{ user.user_id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role|default('User') }}</td>
                <td>{{ user.created_at.strftime('%Y-%m-%d') }}</td>
                <td>
                    <span class="px-2 py-1 text-xs rounded-full 
                        {% if user.active %}bg-green-500/20 text-green-500
                        {% else %}bg-gray-500/20 text-gray-500{% endif %}">
                        {{ 'Active' if user.active else 'Inactive' }}
                    </span>
                </td>
                <td class="flex space-x-2">
                <a href="{{ url_for('edit_user', user_id=user.user_id) }}" class="text-blue-500 hover:text-blue-500/80">
                    <i class="fas fa-edit"></i>
                </a>
                <button class="text-red-500 hover:text-red-500/80" onclick="confirmDelete('{{ user.user_id }}')">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        if ($.fn.DataTable.isDataTable('#usersTable')) {
            $('#usersTable').DataTable().destroy();
        }
        $('#usersTable').DataTable({
            "pagingType": "simple_numbers",
            "lengthMenu": [10, 25, 50, 100],
            "language": {
                "search": "Filter users:"
            }
        });
    });
    
    // Placeholder for confirmDelete function if not already defined in base.html or elsewhere
    // You would typically implement a custom modal here instead of alert/confirm
    function confirmDelete(userId) {
        // Example: Replace with a custom modal for confirmation
        alert('Delete user with ID: ' + userId);
        // In a real application, you'd send an AJAX request to delete the user
        // fetch(`/users/delete/${userId}`, { method: 'POST' })
        // .then(response => response.json())
        // .then(data => {
        //     if (data.success) {
        //         window.showSuccessToast('User deleted successfully!');
        //         location.reload(); // Reload the page to update the table
        //     } else {
        //         window.showErrorToast('Failed to delete user: ' + data.message);
        //     }
        // })
        // .catch(error => {
        //     console.error('Error deleting user:', error);
        //     window.showErrorToast('Error deleting user.');
        // });
    }
</script>
{% endblock %}
