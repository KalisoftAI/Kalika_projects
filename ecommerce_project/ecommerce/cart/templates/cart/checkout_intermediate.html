
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto py-8">
    <h1 class="text-3xl font-bold text-blue-900 mb-6">Checkout - Manual Punchout Setup</h1>
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} mb-4" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    {% if cart_items %}
        <div class="space-y-4">
            {% for item in cart_items %}
                <div class="flex items-center bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition duration-300">
                    {% if item.item.product.image_url %}
                        <img src="{{ item.item.product.image_url|default:'https://via.placeholder.com/100' }}" alt="{{ item.item.product.product_title }}" class="w-24 h-24 object-cover rounded-md mr-4">
                    {% else %}
                        <img src="https://via.placeholder.com/100" alt="No Image" class="w-24 h-24 object-cover rounded-md mr-4">
                    {% endif %}
                    <div class="flex-1">
                        <h2 class="text-xl font-semibold">{{ item.item.product.product_title }}</h2>
                        <p class="text-gray-600">Quantity: {{ item.item.quantity }}</p>
                        <p class="text-gray-600">Price: ${{ item.item.product.price|floatformat:2 }}</p>
                        <p class="text-gray-600">Subtotal: ${{ item.subtotal|floatformat:2 }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="mt-6 text-right">
            <p class="text-2xl font-bold text-blue-900">Total: ${{ total|floatformat:2 }}</p>
        </div>
        <div class="mt-6">
            <p class="text-gray-600">Session Key: {{ session_key }}</p>
            <p class="text-gray-600">Please use the cart details above to manually generate cXML and send it to your SAP Ariba Punchout URL.</p>
            <p class="text-gray-600">Sample cXML structure (copy and customize):</p>
            <pre class="bg-gray-200 p-2 rounded">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;cXML payloadID="unique_id_{{ session_key }}" timestamp="{{ request.get_full_path|date:'c' }}"&gt;
    &lt;Header&gt;
        &lt;From&gt;&lt;Credential domain="Supplier"&gt;&lt;Identity&gt;your_supplier_id&lt;/Identity&gt;&lt;/Credential&gt;&lt;/From&gt;
        &lt;To&gt;&lt;Credential domain="AribaNetworkUser"&gt;&lt;Identity&gt;buyer_id&lt;/Identity&gt;&lt;/Credential&gt;&lt;/To&gt;
        &lt;Sender&gt;&lt;Credential domain="Supplier"&gt;&lt;Identity&gt;your_supplier_id&lt;/Identity&gt;&lt;/Credential&gt;&lt;/Sender&gt;
    &lt;/Header&gt;
    &lt;Request&gt;
        &lt;PunchOutOrderMessage&gt;
            &lt;Items&gt;
                {% for item in cart_items %}
                &lt;ItemOut&gt;
                    &lt;ItemID&gt;&lt;SupplierPartID&gt;{{ item.item.product.item_code }}&lt;/SupplierPartID&gt;&lt;/ItemID&gt;
                    &lt;ItemDetail&gt;&lt;UnitPrice&gt;&lt;Money currency="USD"&gt;{{ item.item.product.price }}&lt;/Money&gt;&lt;/UnitPrice&gt;&lt;Description&gt;{{ item.item.product.product_title }}&lt;/Description&gt;&lt;/ItemDetail&gt;
                    &lt;Quantity&gt;{{ item.item.quantity }}&lt;/Quantity&gt;
                &lt;/ItemOut&gt;
                {% endfor %}
            &lt;/Items&gt;
        &lt;/PunchOutOrderMessage&gt;
    &lt;/Request&gt;
&lt;/cXML&gt;
            </pre>
            <a href="{% url 'cart:view_cart' %}" class="mt-4 inline-block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Back to Cart</a>
        </div>
    {% else %}
        <p class="text-gray-600">Your cart is empty.</p>
    {% endif %}
</div>
{% endblock %}